

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; btk 0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.0/dist/embed-amd.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/jupyter-sphinx.css" type="text/css" />
  <link rel="stylesheet" href="_static/thebelab.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Input Catalog" href="catalog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> btk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Input Catalog</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="src/btk.html">BlendingToolKit API</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">btk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>This document gives a detailed look into the work-flow of <em>BlendingToolKit</em> (btk). For a quick tutorial on how to run btk, see the jupyter notebook tutorials <a class="reference external" href="tutorials.html">here</a>. This page is especially useful if you plan to use btk with your own detection/deblending/measurement algorithm. The workflow presented here should be as general as possible ; examples for the WeakLensingDeblending case are also given.</p>
<p>The workflow of btk is shown here:</p>
<img alt="_images/current_flowchart.png" class="align-center" src="_images/current_flowchart.png" />
<ol class="arabic simple">
<li><p>Set parameter values : define parameter values to create postage stamps, including size of stamp, number of objects per blend, and how many stamps are to be drawn in one batch – i.e., the number of stamps btk will produce together in a singe batch. The observing survey name (e.g., LSST, DES), the name of the input catalog to draw objects from, and the names of the observing bands are also specified here.</p></li>
<li><p>Load Catalog : Reads the input catalog file. This must be done using a <a class="reference internal" href="src/btk.catalog.html#btk.catalog.Catalog" title="btk.catalog.Catalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">WLDCatalog</span></code>), either by providing directly the catalog or by using the <a class="reference internal" href="src/btk.catalog.html#btk.catalog.Catalog.from_file" title="btk.catalog.Catalog.from_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_file()</span></code></a> method. Additionally, the catalog can be filtered using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_selection_function()</span></code> method and providing an appropriate selection function.</p></li>
<li><p>(optional) Define your own <a class="reference internal" href="src/btk.sampling_functions.html#btk.sampling_functions.SamplingFunction" title="btk.sampling_functions.SamplingFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SamplingFunction</span></code></a>. A sampling function is a callable object, which takes into input a catalog and returns specific entries along with parameters for a given blend (such as object shifts in the stamp for instance). You may use the default class <code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultSamplingFunction</span></code>, or define a new one if you want to have more control over how the galaxies are selected and the blends are defined.</p></li>
<li><p>(optional) Define your own <a class="reference internal" href="src/btk.survey.html#btk.survey.Survey" title="btk.survey.Survey"><code class="xref py py-class docutils literal notranslate"><span class="pre">Survey</span></code></a>. A survey is a namedtuple containing different attributes relating to the observing conditions of a given survey, such as the pixel scale, and several <a class="reference internal" href="src/btk.survey.html#btk.survey.Filter" title="btk.survey.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> instances, which are also namedtuples containing attributes corresponding to the different filters of the survey (eg the exposition time or the sky brightness). PSF information is also contained in each of the <a class="reference internal" href="src/btk.survey.html#btk.survey.Filter" title="btk.survey.Filter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Filter</span></code></a> instance. You may either use one of the default surveys already defined in btk.survey, or define your own survey to have more control of the parameters. Images for several surveys may also be produced by replacing the survey object by a list of survey objects.</p></li>
<li><p>Draw blends : Simulates scene of overlapping objects, convolved by the PSF and with pixel noise. This step is done by creating a <a class="reference internal" href="src/btk.draw_blends.html#btk.draw_blends.DrawBlendsGenerator" title="btk.draw_blends.DrawBlendsGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">DrawBlendsGenerator</span></code></a>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">WLDGenerator</span></code>), which is given the catalog, sampling function and survey created in step 2 to 4. It can then be called using <em>next(&lt;draw blends generator&gt;)</em> to get the results as a dictionary, including the blends with the key <em>blend_images</em>, the isolated galaxy images with the key <em>isolated_images</em> and the blend parameters with the key <em>blend_list</em>. In the case where multiple surveys were provided in step 4, each entry will instead take the form of a dictionary indexed by the survey names, with each value corresponding to the information for one of the surveys.</p></li>
<li><p>Detection/Deblending/Measure : Performs user-defined measurements (detection, segmentation, deblended images) on the generated blends. The user may create a <a class="reference internal" href="src/btk.measure.html#btk.measure.MeasureGenerator" title="btk.measure.MeasureGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeasureGenerator</span></code></a>, providing the draw blends generator from step 5 as well as one or several measure function(s), which perform the measurements on one blend. The user is expected to write his own measure function, an implementation for <a class="reference external" href="https://sep.readthedocs.io/en/v1.0.x/index.html">SEP</a> (SourceExtractor with python) is available as an example.</p></li>
<li><p>Compute metrics : matches the detections to the true galaxies and compute metrics relative to the quality of the detection, segmentation and deblended images. This is achieved using a <a class="reference internal" href="src/btk.metrics.html#btk.metrics.MetricsGenerator" title="btk.metrics.MetricsGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsGenerator</span></code></a> object, which takes as an argument the measure generator from step 6. For users that do not wish to use the whole BTK framework, the function <a class="reference internal" href="src/btk.metrics.html#btk.metrics.compute_metrics" title="btk.metrics.compute_metrics"><code class="xref py py-func docutils literal notranslate"><span class="pre">compute_metrics()</span></code></a> can be used directly to compute the metrics by directly providing the data.</p></li>
</ol>
<p><em>BlendingToolKit</em> can be run end-to-end using an input yaml config file, parsed by <em>btk_input.py</em>, which then runs btk with the defined parameters. However, this file is broken as of now and cannot be used yet.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="catalog.html" class="btn btn-neutral float-left" title="Input Catalog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, btk developers

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>