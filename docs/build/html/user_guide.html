

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>User Guide &mdash; btk 0.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Tutorials" href="tutorials.html" />
    <link rel="prev" title="Input Catalog" href="catalog.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> btk
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="catalog.html">Input Catalog</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="src/btk.html">btk package</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">btk</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>User Guide</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/user_guide.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="user-guide">
<h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">¶</a></h1>
<p>This document gives a detailed look into the work-flow of <em>BlendingToolKit</em> (btk). For a quick tutorial on how to run btk, see the jupyter notebook tutorials <a class="reference external" href="tutorials.html">here</a>. This page is especially useful if you plan to use btk with your own detection/deblending/measurement algorithm. The workflow presented here should be as general as possible ; examples for the WeakLensingDeblending case are also given.</p>
<p>The workflow of btk is shown here:</p>
<img alt="_images/flow_chart.png" class="align-center" src="_images/flow_chart.png" />
<ol class="arabic simple">
<li><p>Set parameter values : define parameter values to create postage stamps, including size of stamp, number of objects per blend, and how many stamps are to be drawn in one batch – i.e., the number of stamps btk will produce together in a singe batch. The observing survey name (e.g., LSST, DES), the name of the input catalog to draw objects from, and the names of the observing bands are also specified here.</p></li>
<li><p>Load Catalog : Reads the input catalog file. This must be done using a <a class="reference internal" href="src/btk.catalog.html#btk.catalog.Catalog" title="btk.catalog.Catalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">Catalog</span></code></a>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">WLDCatalog</span></code>), either by providing directly the catalog or by using the <a class="reference internal" href="src/btk.catalog.html#btk.catalog.Catalog.from_file" title="btk.catalog.Catalog.from_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_file()</span></code></a> method. Additionally, the catalog can be filtered using the <code class="xref py py-meth docutils literal notranslate"><span class="pre">apply_selection_function()</span></code> method and providing an appropriate selection function.</p></li>
<li><p>Make blend samples : Samples objects from the input catalog based on a user defined sampling function to create an astropy table with parameters of each blend. This is done using a <a class="reference internal" href="src/btk.create_blend_generator.html#btk.create_blend_generator.BlendGenerator" title="btk.create_blend_generator.BlendGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlendGenerator</span></code></a> object, which must be given a <a class="reference internal" href="src/btk.sampling_functions.html#btk.sampling_functions.SamplingFunction" title="btk.sampling_functions.SamplingFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SamplingFunction</span></code></a>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultSamplingFunction</span></code>). The sampling function is a callable object which defines the parameters relative to each blend, ie which galaxies will be drawn, in what position, etc. Once created, the <a class="reference internal" href="src/btk.create_blend_generator.html#btk.create_blend_generator.BlendGenerator" title="btk.create_blend_generator.BlendGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">BlendGenerator</span></code></a> can be called using <em>next(&lt;blend_generator&gt;)</em>, which will give a batch of blend parameters. Users who want more control on their blend parameters may create a custom sampling function, based on the <a class="reference internal" href="src/btk.sampling_functions.html#btk.sampling_functions.SamplingFunction" title="btk.sampling_functions.SamplingFunction"><code class="xref py py-class docutils literal notranslate"><span class="pre">SamplingFunction</span></code></a> class.</p></li>
<li><p>Make observing conditions : Defines the observing conditions, ie the PSF, pixel scale, noise level, etc. This is achieved using a <code class="xref py py-class docutils literal notranslate"><span class="pre">ObservingGenerator</span></code>, which must be given a <code class="xref py py-class docutils literal notranslate"><span class="pre">ObsConditions</span></code> object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">DefaultObsConditions</span></code>), as well as the list of surveys. Much like the sampling function, the obs conditions is a callable object, which returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">Cutout</span></code>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">WLDCutout</span></code>) when given a survey and a band. The observing generator can be called using <em>next(&lt;observing generator&gt;)</em>, which will return a dictionary containing cutouts corresponding to each band in each survey.  Note that all blends drawn in a batch will be generated with the same observing conditions. As for the sampling function, users may want to create a custom obs conditions object (and possibly a custom cutout) if they wish to have more control over the observing conditions.</p></li>
<li><p>Draw blends : Simulates scene of overlapping objects, convolved by the PSF and with pixel noise. This step is done by creating a <a class="reference internal" href="src/btk.draw_blends.html#btk.draw_blends.DrawBlendsGenerator" title="btk.draw_blends.DrawBlendsGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">DrawBlendsGenerator</span></code></a>-like object (e.g. <code class="xref py py-class docutils literal notranslate"><span class="pre">WLDGenerator</span></code>), which is given the blend and observing generator created in step 4 and 5. It can then be called using <em>next(&lt;draw blends generator&gt;)</em> to get the results as a dictionary, including the blends with the key <em>blend_images</em>, the isolated galaxy images with the key <em>isolated_images</em> and the blend parameters with the key <em>blend_list</em>. In the case where multiple surveys were provided in step 4, the results will instead take the form of a dictionary indexed by the survey names, each entry containing a dictionary with the aforementioned entries.</p></li>
<li><p>Detection/Deblending/Measure : Performs user-defined measurements on the generated blends. The user may create a <a class="reference internal" href="src/btk.measure.html#btk.measure.MeasureGenerator" title="btk.measure.MeasureGenerator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeasureGenerator</span></code></a>, providing the draw blends generator from step 5 as well as a <a class="reference internal" href="src/btk.measure.html#btk.measure.MeasurementParams" title="btk.measure.MeasurementParams"><code class="xref py py-class docutils literal notranslate"><span class="pre">MeasurementParams</span></code></a>-like object. There is no default instance of the measurement params, however some examples are available in <code class="xref py py-class docutils literal notranslate"><span class="pre">utils</span></code>, including implementations of <a class="reference external" href="https://sep.readthedocs.io/en/v1.0.x/index.html">SEP</a> (SourceExtractor with python) , <a class="reference external" href="https://pipelines.lsst.io">LSST science pipeline</a> and <a class="reference external" href="https://scarlet.readthedocs.io/en/latest/index.html">SCARLET</a>.</p></li>
<li><p>Compute metrics : compares the true centroids, shapes, and flux values to those predicted by the user-provided algorithm. Currently, BTK assesses only detection performance by returning the number of objects correctly detected, the number that are undetected and the number of spurious detections. This is achieved using a <code class="xref py py-class docutils literal notranslate"><span class="pre">MetricsParams</span></code> object, which takes as an argument the measure generator from step 6, and can be fed to the <code class="xref py py-func docutils literal notranslate"><span class="pre">run()</span></code> function to get the desired results. Please note that this section may be reworked in the future.</p></li>
</ol>
<p><em>BlendingToolKit</em> can be run end-to-end using an input yaml config file, parsed by <em>btk_input.py</em>, which then runs btk with the defined parameters. However, this file is broken as of now and cannot be used yet.</p>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="tutorials.html" class="btn btn-neutral float-right" title="Tutorials" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="catalog.html" class="btn btn-neutral float-left" title="Input Catalog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2019, btk developers

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>