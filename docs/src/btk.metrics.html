<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>btk.metrics module &mdash; btk 1.0.0a2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/jupyter-sphinx.css" type="text/css" />
      <link rel="stylesheet" href="../_static/thebelab.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/thebelab-helper.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
        <script src="https://unpkg.com/@jupyter-widgets/html-manager@^0.20.1/dist/embed-amd.js"></script>
        <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="btk.plot_utils module" href="btk.plot_utils.html" />
    <link rel="prev" title="btk.measure module" href="btk.measure.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> btk
          </a>
              <div class="version">
                1.
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../install.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../catalog.html">Input Catalog</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials.html">Tutorials</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="btk.html">BlendingToolKit API</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="btk.html#module-btk">Module contents</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="btk.html#submodules">Submodules</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="btk.catalog.html">btk.catalog module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.create_blend_generator.html">btk.create_blend_generator module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.draw_blends.html">btk.draw_blends module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.measure.html">btk.measure module</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">btk.metrics module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.plot_utils.html">btk.plot_utils module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.sampling_functions.html">btk.sampling_functions module</a></li>
<li class="toctree-l3"><a class="reference internal" href="btk.survey.html">btk.survey module</a></li>
</ul>
</li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">btk</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="btk.html">BlendingToolKit API</a> &raquo;</li>
      <li>btk.metrics module</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/src/btk.metrics.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="module-btk.metrics">
<span id="btk-metrics-module"></span><h1>btk.metrics module<a class="headerlink" href="#module-btk.metrics" title="Permalink to this heading"></a></h1>
<p>Implements a variety of metrics for evaluating measurement results in BTK.</p>
<p>BTK users are expected to use the MetricsGenerator class, which is initialized by providing
a MeasureGenerator as well as some parameters. Users which do not want to use the full BTK
pipeline may use the compute_metrics function which takes the raw data as an input.</p>
<p>Currently, we support the following metrics:</p>
<ul>
<li><p>For detection, all metrics are per batch:</p>
<ul class="simple">
<li><p>Number of true positives, ie number of true galaxies which have been correctly detected</p></li>
<li><p>Number of false positives, ie number of detected galaxies which do not correspond
to a true galaxy</p></li>
<li><p>Number of false negatives, ie number of true galaxies which have not been detected</p></li>
<li><p>Precision, the ratio of true positives against the total number of positives; describes
how much the algorithm is susceptible to make false detections (closer to 1 is better)</p></li>
<li><p>Recall, the ratio of true positives against the number of true galaxies (which is equal
to true positives + false negatives); indicates the capacity of the algorithm for
detecting all the galaxies (closer to 1 is better)</p></li>
<li><p>F1 score, the harmonic mean of precision and recall; gives an overall assessment of the
detection (closer to 1 is better)</p></li>
<li><p>Efficiency matrix, contains for each possible number of true galaxies in a blend the
distribution of the number of detected galaxies in blends containing this number of true
galaxies.</p></li>
</ul>
</li>
<li><p>For segmentation, all metrics are per galaxy:</p>
<ul class="simple">
<li><p>Intersection-over-Union (IoU), the ratio between the intersection of the true and
detected segmentations (true segmentation is computed by applying a threshold on
the true image) and the union of the two. Closer to 1 is better.</p></li>
</ul>
</li>
<li><p>For reconstruction, all metrics are per galaxy:</p>
<ul class="simple">
<li><p>Mean Square Residual (MSR), the mean square error between the true image and the
deblended image. Lower is better.</p></li>
<li><p>Peak Signal to Noise Ratio (PSNR), the log of the maximum value in the image divided
by the MSR squared (result is in dB). Higher is better.</p></li>
<li><p>Structure Similarity Index (SSIM), a more advanced metric based on perceptual
considerations, divided in luminance, contrast and structure. Closer to 1 is better.</p></li>
</ul>
</li>
<li><p>Additionnal information provided:</p>
<ul>
<li><p>Distance between the detection and the true galaxy</p></li>
<li><p>Distance to the closest true galaxy</p></li>
<li><p>Blendedness, defined as:</p>
<div class="math notranslate nohighlight">
\[1 - \frac{S_k \cdot S_k}{S_{all} \cdot S_k}\]</div>
<p>where <span class="math notranslate nohighlight">\(S_k\)</span> is the flux of the k-th galaxy for each pixel (as a vector),
<span class="math notranslate nohighlight">\(S_{all}\)</span> is the flux of all the galaxies for each pixel, and <span class="math notranslate nohighlight">\(\cdot\)</span>
is the standard scalar product on vectors.</p>
</li>
</ul>
</li>
</ul>
<dl class="py class">
<dt class="sig sig-object py" id="btk.metrics.MetricsGenerator">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">MetricsGenerator</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">measure_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_band_name='r'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_threshold_factor=3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_distance=&lt;function</span> <span class="pre">distance_center&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_threshold_match=5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.MetricsGenerator" title="Permalink to this definition"></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<p>Generator that calculates metrics on batches returned by the MeasureGenerator.</p>
<dl class="py method">
<dt class="sig sig-object py" id="btk.metrics.MetricsGenerator.__init__">
<span class="sig-name descname"><span class="pre">__init__</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">measure_generator</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_band_name='r'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_threshold_factor=3</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_distance=&lt;function</span> <span class="pre">distance_center&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_threshold_match=5.0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose=False</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.MetricsGenerator.__init__" title="Permalink to this definition"></a></dt>
<dd><p>Initialize metrics generator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>measure_generator</strong> (<a class="reference internal" href="btk.measure.html#btk.measure.MeasureGenerator" title="btk.measure.MeasureGenerator"><em>btk.measure.MeasureGenerator</em></a>) – Measurement generator object.</p></li>
<li><p><strong>meas_band_name</strong> (<em>str</em><em> or </em><em>tuple</em>) – Specifies the name of the band in which you want
measurements to be done (for segmentation and target measures). If
multiresolution, should be a tuple containing a band for each survey
(in the same order as the surveys were given).</p></li>
<li><p><strong>target_meas</strong> (<em>dict</em>) – Dictionary containing functions that can measure a physical
parameter on isolated galaxy images. Each key is the name of the estimator and
value the function performing the estimation (e.g. <cite>meas_ellipticity</cite> above).</p></li>
<li><p><strong>noise_threshold_factor</strong> (<em>float</em>) – Factor for determining the threshold which is
applied when getting segmentations from true images. A value of 3 would
correspond to a threshold of 3 sigmas (with sigma the standard deviation of
the noise)</p></li>
<li><p><strong>save_path</strong> (<em>str</em>) – Path to directory where results will be saved. If left
as None, results will not be saved.</p></li>
<li><p><strong>f_distance</strong> (<em>func</em>) – Function used to compute the distance between true and detected
galaxies. Takes as arguments the entries corresponding to the two galaxies.
By default the distance is the euclidean distance from center to center.</p></li>
<li><p><strong>distance_threshold_match</strong> (<em>float</em>) – Maximum distance for matching a detected and a
true galaxy in pixels.</p></li>
<li><p><strong>verbose</strong> (<em>bool</em>) – Indicates whether errors in the target_meas should be printed or not.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.auc">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">auc</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">metrics_results</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">measure_name</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">n_meas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">plot</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ax</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.auc" title="Permalink to this definition"></a></dt>
<dd><p>Computes the average precision metric and plot the Precision-Recall curve.</p>
<p>The average precision is defined as the area under the precision-recall curve.
The precision-recall curve is obtained by running the same algorithm with
different thresholds, and plotting the curve with recall as the x axis
and precision as the y axis (see detection metrics for a definition of
precision and recall).
This should be used by providing a list of different kwargs to a measure
generator, proceed as usual, and give the results of the metrics generator
to this function.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>metrics_results</strong> (<em>dict</em>) – Output of a btk.metrics.MetricsGenerator.</p></li>
<li><p><strong>measure_name</strong> (<em>str</em>) – Base name of the measure function which will be
evaluated.</p></li>
<li><p><strong>n_meas</strong> (<em>int</em>) – Number of different kwargs which were given.</p></li>
<li><p><strong>plot</strong> (<em>bool</em>) – Set to True to plot the precision-recall curve.</p></li>
<li><p><strong>ax</strong> (<em>matplotlib.axes.Axes</em>) – If plot is True, the results will be</p></li>
<li><p><strong>ax.</strong> (<em>drawn on this</em>) – </p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>An int corresponding to the average precision.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.compute_metrics">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">compute_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isolated_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blend_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detection_catalogs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segmentations=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deblended_images=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_threshold=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_band_num=0</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas={}</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">channels_last=False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">save_path=None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_distance=&lt;function</span> <span class="pre">distance_center&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_threshold_match=5.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.compute_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Computes all requested metrics given information in a single batch from measure_generator.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>isolated_images</strong> (<em>array</em>) – Contains all the isolated images, with shape NMCHW OR NMHWC
depending on channels_last, with M the maximum number of galaxies
in a blend.</p></li>
<li><p><strong>blend_list</strong> (<em>list</em>) – Contains the information related to all blends, as a list of astropy
Tables (one for each blend). Those tables should at least
contain columns indicating the position in pixels of each galaxy,
named “x_peak” and “y_peak”.</p></li>
<li><p><strong>detection_catalogs</strong> (<em>list</em>) – Contains the information on the detections for all blends, as a
list of astropy Tables (one for each blend). Those tables
should at least contain columns indicating the position
in pixels of each detected galaxy, named “x_peak” and “y_peak”.</p></li>
<li><p><strong>segmentations</strong> (<em>list</em>) – Contains the measured segmentations, as a list of boolean arrays of
shape MHW where M is the number of detected objects (must be
consistent with corresponding detection catalog).</p></li>
<li><p><strong>deblended_images</strong> (<em>list</em>) – Contains the deblended images, as a list of arrays of shape NCHW
or NHWC depending on channels_last, where N is the number of
detected objects (must be consistent with corresponding
detection catalogs).</p></li>
<li><p><strong>noise_threshold</strong> (<em>float</em>) – Threshold to use when computing the true segmentations from
isolated images.</p></li>
<li><p><strong>meas_band_num</strong> (<em>int</em>) – Indicates in which band some of the measurements should be done.</p></li>
<li><p><strong>target_meas</strong> (<em>dict</em>) – Contains functions measuring target parameters on images, which will
be returned for both isolated and deblended images to compare.</p></li>
<li><p><strong>channels_last</strong> (<em>bool</em>) – Indicates whether the images should be channels first (NCHW)
or channels last (NHWC).</p></li>
<li><p><strong>save_path</strong> (<em>str</em>) – Path to directory where results will be saved. If left
as None, results will not be saved.</p></li>
<li><p><strong>f_distance</strong> (<em>func</em>) – Function used to compute the distance between true and detected
galaxies. Takes as arguments the entries corresponding to the two galaxies.
By default the distance is the euclidean distance from center to center.</p></li>
<li><p><strong>distance_threshold_match</strong> (<em>float</em>) – Maximum distance for matching a detected and a
true galaxy in pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>Contains all the computed metrics. Entries are:</dt><dd><ul class="simple">
<li><p>matches: list of astropy Tables containing the matched detected galaxy
for each true galaxy</p></li>
<li><p>detection: dict containing the raw results for detection</p></li>
<li><p>segmentation: dict containing the raw results for segmentation</p></li>
<li><p>reconstruction: dict containing the raw results for reconstruction</p></li>
<li><p>galaxy_summary: astropy Table containing all the galaxies from all
blends and related metrics</p></li>
</ul>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>results (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.detection_metrics">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">detection_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">detection_catalogs</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matches</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.detection_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Calculate detection metrics based on matches from <cite>get_detection_match</cite> function.</p>
<p>Currently implemented detection metrics include:
- recall
- precision
- f1</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>detection_catalogs</strong> (<em>list</em>) – Contains one astropy Table for each blend,
corresponding to the detected galaxies.</p></li>
<li><p><strong>matches</strong> (<em>list</em>) – Contains one astropy Table for each blend, with a
column <cite>match_detected_id</cite> containing the index of the
matched detected galaxy for each true galaxy.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Dictionary containing keys corresponding to each implemented
metric. Each value is a list where each element corresponds to each element of
the batch (a single blend).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>results_detection (dict)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.distance_center">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">distance_center</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">true_gal</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_gal</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.distance_center" title="Permalink to this definition"></a></dt>
<dd><p>Computes the euclidean distance between the two galaxies given as arguments.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>true_gal</strong> (<em>astropy.table.Table</em>) – Contains information related to the true galaxy.</p></li>
<li><p><strong>detected_gal</strong> (<em>astropy.table.Table</em>) – Contains information related to the detected galaxy</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Distance between the two galaxies</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.get_blendedness">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">get_blendedness</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">iso_image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">blend_iso_images</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.get_blendedness" title="Permalink to this definition"></a></dt>
<dd><p>Calculate blendedness given isolated images of each galaxy in a blend.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>iso_image</strong> (<em>np.array</em>) – Array of shape = (H,W) corresponding to image of the isolated
galaxy you are calculating blendedness for.</p></li>
<li><p><strong>blend_iso_images</strong> (<em>np.array</em>) – Array of shape = (N, H, W) where N is the number of galaxies
in the blend and each image of this array corresponds to an isolated galaxy that is
part of the blend (includes <cite>iso_image</cite>).</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.get_detection_eff_matrix">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">get_detection_eff_matrix</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">summary_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.get_detection_eff_matrix" title="Permalink to this definition"></a></dt>
<dd><p>Computes the detection efficiency matrix for the input detection summary table.</p>
<p>Input argument num sets the maximum number of true objects per blend in the
test set for which the
detection efficiency matrix is to be created for. Detection efficiency is
computed for a number of true objects in the range (0-num) as columns and
the detection percentage as rows. The percentage values in a column sum to
100.
The input summary table must be a numpy array of shape [N, 5], where N is
the test set size. The 5 columns in the summary_table are number of true
objects, detected sources, undetected objects, spurious detections and
shredded objects for each of the N blend scenes in the test set.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>summary_table</strong> (<cite>numpy.array</cite>) – Detection summary as a table [N, 5].</p></li>
<li><p><strong>num</strong> (<em>int</em>) – Maximum number of true objects to create matrix for. Number
of columns in efficiency matrix will be num+1. The first column
will correspond to no true objects.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>numpy.ndarray of size[num+2, num+1] that shows detection efficiency.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.get_detection_match">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">get_detection_match</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">true_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_table</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">f_distance=&lt;function</span> <span class="pre">distance_center&gt;</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">distance_threshold_match=5.0</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.get_detection_match" title="Permalink to this definition"></a></dt>
<dd><p>Uses the Hungarian algorithm to find optimal matching between detections and true objects.</p>
<p>The optimal matching is computed based on the following optimization problem:</p>
<div class="math notranslate nohighlight">
\[\sum_{i} \sum_{j} C_{i,j} X_{i,j}\]</div>
<p>where, in the BTK context, <span class="math notranslate nohighlight">\(C_{ij}\)</span> is the cost function between matching true object
<span class="math notranslate nohighlight">\(i\)</span> with detected object <span class="math notranslate nohighlight">\(j\)</span> computed as the L2 distance between the two objects,
and <span class="math notranslate nohighlight">\(X_{i,j}\)</span> is an indicator function over the matches.</p>
<p>Based on this implementation in scipy:
<a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linear_sum_assignment.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.linear_sum_assignment.html</a></p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>true_table</strong> (<em>astropy.table.Table</em>) – Table with entries corresponding to
the true object parameter values in one blend.</p></li>
<li><p><strong>detected_table</strong> (<em>astropy.table.Table</em>) – Table with entries corresponding
to output of measurement algorithm in one blend.</p></li>
<li><p><strong>f_distance</strong> (<em>func</em>) – Function used to compute the distance between true and detected
galaxies. Takes as arguments the entries corresponding to the two galaxies.
By default the distance is the euclidean distance from center to center.</p></li>
<li><p><strong>distance_threshold_match</strong> (<em>float</em>) – Maximum distance for matching a detected and a
true galaxy in pixels.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><p>Table where each row corresponds to each true
galaxy in <cite>true_table</cite> and contains two columns:</p>
<ul class="simple">
<li><p>”match_detected_id”: Index of row in <cite>detected_table</cite> corresponding to
matched detected object. If no match, value is -1.</p></li>
<li><p>”dist”: distance between true object and matched object or 0 if no matches.</p></li>
</ul>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>match_table (astropy.table.Table)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.meas_ksb_ellipticity">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">meas_ksb_ellipticity</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">image</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">additional_params</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.meas_ksb_ellipticity" title="Permalink to this definition"></a></dt>
<dd><p>Utility function to measure ellipticity using the <cite>galsim.hsm</cite> package, with the KSB method.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>image</strong> (<em>np.array</em>) – Image of a single, isolated galaxy with shape (H, W).</p></li>
<li><p><strong>additional_params</strong> (<em>dict</em>) – Containing keys ‘psf’, ‘pixel_scale’ and ‘meas_band_num’.
The psf should be a Galsim PSF model, and meas_band_num
an integer indicating the band in which the measurement
is done.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.reconstruction_metrics">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">reconstruction_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isolated_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deblended_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matches</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">{}</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.reconstruction_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Calculate reconstruction metrics given information from a single batch.</p>
<p>Currently implemented reconstruction metrics include:
- Mean Squared Residual (MSR)
- Peak Signal-to-Noise Ratio (PSNR)
- Structural Similarity (SSIM)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>isolated_images</strong> (<em>array</em>) – Contains the isolated true galaxy images,
with shape NMCHW where M is the maximum number
of galaxies in the blend and N the number of
blends in a batch.</p></li>
<li><p><strong>deblended_images</strong> (<em>array</em>) – Contains the deblended images,
as an array with shape NLCHW, where
L is the number of detected galaxies and N
the number of blends in a batch.</p></li>
<li><p><strong>matches</strong> (<em>list</em>) – Contains one astropy Table for each blend, with a
column <cite>match_detected_id</cite> containing the index of the
matched detected galaxy for each true galaxy.</p></li>
<li><p><strong>target_meas</strong> (<em>dict</em>) – Contains the target measurement functions provided
by the user.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Contains the results for the batch</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p><p>results_reconstruction (astropy.table.Table)</p>
<p>with one column for each metric (currently: “msr”
for MSR, “psnr” for PSNR, “ssim” for SSIM, and
“target_name” and “target_name_true” for each
function target_name in target_meas (if the
function has several outputs, a number is added
after target_name for each output)).</p>
</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.reconstruction_metrics_blend">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">reconstruction_metrics_blend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isolated_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">deblended_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matches</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">target_meas_keys</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.reconstruction_metrics_blend" title="Permalink to this definition"></a></dt>
<dd><p>Calculates reconstruction metrics given information from a single blend.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>isolated_images</strong> (<em>array</em>) – Contains the isolated true galaxy images,
with shape MCHW where M is the number of
galaxies in the blend.</p></li>
<li><p><strong>deblended_images</strong> (<em>array</em>) – Contains the deblended images,
as a boolean array with shape LCHW, where
L is the number of detected galaxies.</p></li>
<li><p><strong>matches</strong> (<em>astropy.table.Table</em>) – Contains the index of the matching detected
galaxy for each true galaxy, under the column
<cite>match_detected_id</cite>.</p></li>
<li><p><strong>target_meas</strong> (<em>dict</em>) – Contains the target measurement functions provided
by the user.</p></li>
<li><p><strong>target_meas_key</strong> (<em>list</em>) – Contains the relevant keys, to manage the case
where one of the target measurement functions
has multiple outputs.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p><dl class="simple">
<dt>Contains the results for the Mean Square Residual</dt><dd><p>metric for each galaxy.</p>
</dd>
<dt>psnr_blend_result (list): Contains the results for the Peak Signal to Noise</dt><dd><p>Ratio metric for each galaxy.</p>
</dd>
<dt>ssim_blend_result (list): Contains the results for the Structure Similarity</dt><dd><p>Index metric for each galaxy.</p>
</dd>
<dt>target_meas_blend_result (dict): Contains the results for the target</dt><dd><p>measurement function for each galaxy (both
true and deblended images).</p>
</dd>
</dl>
</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>msr_blend_result (list)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.segmentation_metrics">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">segmentation_metrics</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isolated_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">segmentations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matches</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_band_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.segmentation_metrics" title="Permalink to this definition"></a></dt>
<dd><p>Calculates segmentation metrics given information from a single batch.</p>
<p>Currently implemented segmentation metrics include:
- Intersection-over-Union (IOU)</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>isolated_images</strong> (<em>array</em>) – Contains the isolated true galaxy images,
with shape NMCHW where M is the maximum number
of galaxies in the blend and N the number of
blends in a batch.</p></li>
<li><p><strong>segmentations</strong> (<em>array</em>) – Contains the detected segmentations,
as a boolean array with shape NLHW, where
L is the number of detected galaxies and N
the number of blends in a batch.</p></li>
<li><p><strong>matches</strong> (<em>list</em>) – Contains one astropy Table for each blend, with a
column <cite>match_detected_id</cite> containing the index of the
matched detected galaxy for each true galaxy.</p></li>
<li><p><strong>noise_threshold</strong> (<em>float</em>) – Threshold for a pixel to be considered belonging to
an object in the segmentation. Should be based on the
expected noise level in the full image.</p></li>
<li><p><strong>meas_band_num</strong> (<em>int</em>) – Index of the band in which the true segmentation is computed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Contains the results for the batch
with one column for each metric (currently: “iou” for IoU).</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>results_segmentation (astropy.table.Table)</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="btk.metrics.segmentation_metrics_blend">
<span class="sig-prename descclassname"><span class="pre">btk.metrics.</span></span><span class="sig-name descname"><span class="pre">segmentation_metrics_blend</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">isolated_images</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">detected_segmentations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">matches</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">noise_threshold</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">meas_band_num</span></span></em><span class="sig-paren">)</span><a class="headerlink" href="#btk.metrics.segmentation_metrics_blend" title="Permalink to this definition"></a></dt>
<dd><p>Calculates segmentation metrics given information from a single blend.</p>
<p>The true segmentation is obtained from the isolated images by setting to True
the pixels above the noise_threshold in the band meas_band_num.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>isolated_images</strong> (<em>array</em>) – Contains the isolated true galaxy images,
with shape MCHW where M is the number of
galaxies in the blend.</p></li>
<li><p><strong>detected_segmentations</strong> (<em>array</em>) – Contains the detected segmentations,
as a boolean array with shape LHW, where
L is the number of detected galaxies.</p></li>
<li><p><strong>matches</strong> (<em>astropy.table.Table</em>) – Contains the index of the matching detected
galaxy for each true galaxy, under the column
<cite>match_detected_id</cite>.</p></li>
<li><p><strong>noise_threshold</strong> (<em>float</em>) – Threshold for a pixel to be considered belonging to
an object in the segmentation. Should be based on the
expected noise level in the full image.</p></li>
<li><p><strong>meas_band_num</strong> (<em>int</em>) – Index of the band in which the true segmentation is computed.</p></li>
</ul>
</dd>
<dt class="field-even">Returns</dt>
<dd class="field-even"><p>Contains the results for the IoU metric for each
galaxy.</p>
</dd>
<dt class="field-odd">Return type</dt>
<dd class="field-odd"><p>iou_blend_result (list)</p>
</dd>
</dl>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="btk.measure.html" class="btn btn-neutral float-left" title="btk.measure module" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="btk.plot_utils.html" class="btn btn-neutral float-right" title="btk.plot_utils module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, btk developers.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>